function setUUID(a){if(a&&""!==a&&a!=uuid){uuid=a;var b={uuid:uuid};history.pushState(b,"I ♥ Movies || User Page","?uuid="+encodeURI(uuid)),shareLink.textContent=window.location,shareLink.setAttribute("href",window.location),navHearts.className=""}}function displayError(a){errorMessage.innerHTML=a||"",a?errorMessage.className="alert alert-danger":errorMessage.className="alert alert-danger hidden"}function clearMovies(){for(;moviesContainer.firstChild;)moviesContainer.removeChild(moviesContainer.firstChild);searchInput.value=""}function removeFromHearts(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){4===b.readyState&&200!==b.status&&displayError("Sorry but there was an error removing that heart, please reload the page and try again.")},b.open("DELETE",encodeURI("./favorites/"+a),!0),b.send()}function addToHearts(a,b){var c=new XMLHttpRequest,d=encodeURI("imdbID="+a+"&title="+b);uuid&&(d+="&uuid="+uuid),c.open("POST","./favorites",!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=function(){4===c.readyState&&(200===c.status?setUUID(JSON.parse(c.responseText).uuid):displayError("Sorry but there was an error adding to hearts, please reload the page and try again."))},c.send(d)}function displayMovie(a,b,c){var d,e=document.createElement("div");if(e.className="panel-body","N/A"!=a.Poster){var f=document.createElement("img");f.className="img-rounded pull-left film-poster",f.src=encodeURI(a.Poster),e.appendChild(f)}var g=document.createElement("div");g.className="panel-body",e.appendChild(g);var h=document.createElement("p");h.textContent=a.Plot,g.appendChild(h);var i=document.createElement("ul");g.appendChild(i);for(var j in a)if(a.hasOwnProperty(j)&&-1!==includedDetails.indexOf(j)){var k=document.createElement("li");i.appendChild(k),k.textContent=j+": "+a[j]}c===!0?(b.className="panel panel-danger",d=document.createElement("button"),d.className="btn btn-default",d.textContent="un♥ this movie",g.appendChild(d),d.addEventListener("click",function(a){b.className="panel panel-default",b.parentElement.removeChild(b),removeFromHearts(b.id)},!1)):(b.className="panel panel-default",d=document.createElement("button"),d.className="btn btn-default",d.textContent="♥ this movie",g.appendChild(d),d.addEventListener("click",function(c){b.className="panel panel-danger",c.target.parentNode.removeChild(c.target),addToHearts(a.imdbID,a.Title)},!1)),b.appendChild(e)}function loadHearts(){clearMovies(),displayError();var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&(200===a.status?populateMovies(JSON.parse(a.responseText).movies,!0):displayError("Sorry but there was an error with your request, please reload the page and try again."))},a.open("GET","./favorites/"+uuid,!0),a.send(null)}function loadMovie(a,b,c){displayError();var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){var a=JSON.parse(d.responseText);200===d.status&&"False"!==a.Response?displayMovie(a,b,c):(displayError("Sorry but there was an error with your request, please reload the page and try again."),window.location.href="#")}},d.open("GET",encodeURI(omdbReadUrl+a),!0),d.send(null)}function onMovieSelected(a){event.preventDefault();var b=a.target.parentElement.parentElement,c=a.target.parentElement,d=document.createElement("h3");d.className="panel-title",d.textContent=a.target.textContent,c.appendChild(d),a.target.parentNode.removeChild(a.target),loadMovie(b.id,b,!1)}function populateMovies(a,b){clearMovies();for(var c=document.createDocumentFragment(),d=0;d<a.length;++d){var e=document.createElement("article");e.className="panel panel-default";var f=document.createElement("div");if(f.className="panel-heading",e.appendChild(f),b){e.id=a[d]._id;var g=document.createElement("h3");g.className="panel-title",g.textContent=a[d].title,f.appendChild(g),loadMovie(a[d].imdbID,e,!0)}else{e.id=a[d].imdbID;var h=document.createElement("a");h.setAttribute("href","#"),h.textContent=a[d].Title,h.addEventListener("click",onMovieSelected,!1),f.appendChild(h)}moviesContainer.appendChild(e)}moviesContainer.appendChild(c)}function onSearchClick(){if(!searchBtn.disabled){displayError();var a=searchInput.value;searchBtn.text="Searching...",searchInput.disabled=searchBtn.disabled=!0;var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4===b.readyState){var a=JSON.parse(b.responseText);200===b.status&&"False"!==a.Response?populateMovies(a.Search,!1):displayError("Sorry but there was an error with your request, please try again."),searchBtn.text="Go!",searchInput.disabled=searchBtn.disabled=!1}},b.open("GET",encodeURI(omdbSearchUrl+a),!0),b.send(null)}}function onNavSearchClick(){navSearch.className="active",navHearts.className=uuid?"":"hidden",searchContainer.className="",heartsContainer.className="hidden",clearMovies(),event.preventDefault()}function onNavHeartsClick(){navSearch.className="",navHearts.className="active",searchContainer.className="hidden",heartsContainer.className="",loadHearts(),event.preventDefault()}function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}var searchContainer,heartsContainer,searchInput,searchBtn,navHearts,navFavs,errorMessage,moviesContainer,uuid,shareLink,omdbSearchUrl="http://www.omdbapi.com/?s=",omdbReadUrl="http://www.omdbapi.com/?plot=full&i=",includedDetails=["Released","Genre","Director","Writer","Actors","Metascore"];window.onload=function(){setUUID(getParameterByName("uuid")),searchContainer=document.getElementById("searchContainer"),heartsContainer=document.getElementById("heartsContainer"),searchInput=document.getElementById("searchInput"),searchBtn=document.getElementById("searchBtn"),navSearch=document.getElementById("navSearch"),navHearts=document.getElementById("navHearts"),errorMessage=document.getElementById("errorMessage"),moviesContainer=document.getElementById("movies"),shareLink=document.getElementById("shareLink"),navSearch.addEventListener("click",onNavSearchClick,!1),navHearts.addEventListener("click",onNavHeartsClick,!1),searchBtn.addEventListener("click",onSearchClick,!1),searchInput.addEventListener("keydown",function(a){13===a.keyCode&&onSearchClick()},!1),uuid&&onNavHeartsClick()};